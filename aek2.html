<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Sweet & Salt | Ø·Ø§ÙˆÙ„Ø© 2</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    
    <style>
        :root {
            --primary: #8b0000;
            --primary-dark: #6b0000;
            --accent: #27ae60;
            --bg: #f8f9fa;
            --card-bg: #ffffff;
            --text: #2c3e50;
            --text-light: #7f8c8d;
            --border: #e0e0e0;
            --shadow: 0 4px 20px rgba(0,0,0,0.08);
            --radius: 20px;
            --radius-sm: 12px;
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body {
            font-family: 'Segoe UI', 'Tajawal', sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.6;
            overflow-x: hidden;
            direction: rtl;
        }

        /* Ø§Ù„Ù‡ÙŠØ¯Ø± ÙˆØ§Ù„Ø£Ù‚Ø³Ø§Ù… */
        .nav-header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white; padding: 15px 20px; position: sticky; top: 0; z-index: 100; box-shadow: var(--shadow);
        }
        .nav-header h1 { font-size: 1.5rem; display: flex; align-items: center; gap: 10px; }
        .table-badge { background: rgba(255,255,255,0.2); padding: 4px 12px; border-radius: 20px; font-size: 0.85rem; }

        .category-bar {
            display: flex; gap: 12px; padding: 15px; overflow-x: auto; background: var(--card-bg);
            position: sticky; top: 60px; z-index: 90; box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        .cat-item {
            min-width: 90px; padding: 10px 15px; background: #f0f0f0; border-radius: 25px;
            cursor: pointer; font-weight: 600; color: var(--text-light); white-space: nowrap;
            display: flex; align-items: center; gap: 5px; transition: 0.3s;
        }
        .cat-item.active { background: var(--primary); color: white; box-shadow: 0 4px 12px rgba(139, 0, 0, 0.2); }

        /* Ø§Ù„Ø´Ø¨ÙƒØ© ÙˆØ§Ù„ÙƒØ±ÙˆØª */
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 15px; padding: 15px; margin-bottom: 100px; }
        .card { background: var(--card-bg); border-radius: var(--radius); overflow: hidden; box-shadow: var(--shadow); cursor: pointer; transition: 0.3s; }
        .card img { width: 100%; height: 140px; object-fit: cover; }
        .card-content { padding: 12px; text-align: center; }
        .card h4 { font-size: 0.95rem; margin-bottom: 5px; }
        .card-price { color: var(--primary); font-weight: 700; }

        /* Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ */
        .overlay {
            position: fixed; inset: 0; background: rgba(0,0,0,0.7); display: none; z-index: 2000;
            backdrop-filter: blur(8px); justify-content: center; align-items: flex-end; opacity: 0; transition: 0.3s;
        }
        .overlay.show { display: flex; opacity: 1; }
        .content-panel {
            background: #fff; width: 100%; max-width: 500px; border-radius: 30px 30px 0 0;
            padding: 25px; transform: translateY(100%); transition: 0.4s cubic-bezier(0.32, 0.72, 0, 1);
        }
        .overlay.show .content-panel { transform: translateY(0); }

        /* Ø¹Ø§Ø±Ø¶ Ø§Ù„ÙˆØ³Ø§Ø¦Ø· Ø§Ù„Ù…Ø·ÙˆØ± */
        .media-viewer {
            position: relative; width: 100%; height: 250px; background: #000;
            border-radius: var(--radius); overflow: hidden; margin-bottom: 20px;
        }
        #dishImage { width: 100%; height: 100%; object-fit: cover; }
        #dishVideo { width: 100%; height: 100%; object-fit: cover; display: none; }
        
        .video-play-overlay {
            position: absolute; inset: 0; background: rgba(0,0,0,0.2);
            display: flex; align-items: center; justify-content: center; cursor: pointer;
        }
        .play-button {
            width: 70px; height: 70px; background: var(--primary); color: white;
            border-radius: 50%; display: flex; align-items: center; justify-content: center;
            font-size: 24px; box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }
        .close-video {
            position: absolute; top: 10px; right: 10px; background: rgba(0,0,0,0.5);
            color: white; border: none; width: 30px; height: 30px; border-radius: 50%;
            z-index: 10; display: none;
        }

        /* Ø§Ù„ØªÙØ§ØµÙŠÙ„ ÙˆØ§Ù„Ø£Ø²Ø±Ø§Ø± */
        .details-box { background: #f8f9fa; padding: 15px; border-radius: 12px; margin: 15px 0; border-right: 4px solid var(--primary); }
        .btn-main {
            width: 100%; padding: 16px; border: none; border-radius: 15px; font-weight: 700;
            font-size: 1rem; cursor: pointer; display: flex; justify-content: center; align-items: center; gap: 10px;
        }
        .btn-primary { background: var(--primary); color: white; }
        .btn-success { background: var(--accent); color: white; }
        
        .float-btn {
            position: fixed; bottom: 20px; left: 20px; right: 20px; background: var(--primary);
            color: white; padding: 18px; border-radius: 50px; border: none; font-weight: 700;
            display: flex; justify-content: space-between; z-index: 500; box-shadow: 0 10px 25px rgba(139, 0, 0, 0.3);
        }

        .close-icon { position: absolute; top: 15px; left: 15px; font-size: 20px; color: #999; z-index: 100; cursor: pointer; }
    </style>
</head>
<body>

<div class="nav-header">
    <h1><i class="fas fa-utensils"></i> Sweet & Salt <span class="table-badge">Ø·Ø§ÙˆÙ„Ø© 2</span></h1>
</div>

<div class="category-bar" id="catBar">
    <div class="cat-item active" onclick="changeCat('Ø·Ø¹Ø§Ù…', this)"><i class="fas fa-hamburger"></i> Ø·Ø¹Ø§Ù…</div>
    <div class="cat-item" onclick="changeCat('Ù…Ø´Ø±ÙˆØ¨Ø§Øª', this)"><i class="fas fa-cocktail"></i> Ù…Ø´Ø±ÙˆØ¨Ø§Øª</div>
    <div class="cat-item" onclick="changeCat('ØªØ­Ù„ÙŠØ©', this)"><i class="fas fa-birthday-cake"></i> ØªØ­Ù„ÙŠØ©</div>
</div>

<div id="grid" class="grid"></div>

<div class="overlay" id="dishOverlay">
    <div class="content-panel">
        <i class="fa-solid fa-xmark close-icon" onclick="closeModal('dishOverlay')"></i>
        
        <div class="media-viewer">
            <img id="dishImage" src="">
            <video id="dishVideo" playsinline preload="auto"></video>
            
            <div class="video-play-overlay" id="videoOverlay" onclick="toggleVideo()">
                <div class="play-button" id="playBtnUI">
                    <i class="fas fa-play"></i>
                </div>
            </div>
            <button class="close-video" id="stopVideoBtn" onclick="stopVideo(event)">
                <i class="fas fa-times"></i>
            </button>
        </div>

        <div style="text-align: center;">
            <h2 id="dishName"></h2>
            <p id="dishPrice" style="color:var(--primary); font-size: 1.5rem; font-weight: 800;"></p>
        </div>

        <div class="details-box">
            <p><strong><i class="fas fa-info-circle"></i> Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª:</strong> <span id="dishIng"></span></p>
            <p style="margin-top:8px; color:var(--accent);"><strong><i class="fas fa-leaf"></i> Ø§Ù„ÙÙˆØ§Ø¦Ø¯:</strong> <span id="dishBen"></span></p>
        </div>

        <button id="addBtn" class="btn-main btn-primary" onclick="handleCartAction()">
            <span id="addBtnText">Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø·Ù„Ø¨</span>
            <i class="fas fa-cart-plus"></i>
        </button>
    </div>
</div>

<div class="overlay" id="cartOverlay">
    <div class="content-panel">
        <h3 style="text-align: center; margin-bottom: 20px; border-bottom: 1px solid #eee; padding-bottom: 10px;">ğŸ“‹ Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø·Ø§ÙˆÙ„Ø© 2</h3>
        <div id="cartItemsList" style="max-height: 250px; overflow-y: auto; margin-bottom: 15px;"></div>
        
        <div style="display:flex; justify-content:space-between; font-weight:800; font-size:1.2rem; margin: 15px 0;">
            <span>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ:</span>
            <span id="finalTotal">0 Ø¯Ø¬</span>
        </div>

        <button id="sendBtn" class="btn-main btn-success" onclick="sendOrderToKitchen()">
            <span id="sendBtnText">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ø¢Ù†</span>
            <i class="fas fa-paper-plane"></i>
        </button>
        <button class="btn-main" style="background:none; color:#999;" onclick="closeModal('cartOverlay')">Ø¥ØºÙ„Ø§Ù‚</button>
    </div>
</div>

<button class="float-btn" onclick="openCartConfirmation()">
    <span>Ø§Ù„Ø³Ù„Ø© (<span id="cartCount">0</span>)</span>
    <span id="floatTotal">0 Ø¯Ø¬</span>
</button>

<script>
const firebaseConfig = {
    apiKey: "AIzaSy...", 
    authDomain: "restaurant-e323a.firebaseapp.com",
    projectId: "restaurant-e323a",
    storageBucket: "restaurant-e323a.appspot.com",
    messagingSenderId: "309092455734",
    appId: "..."
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

let cart = [];
let currentItem = null;

// ØªØ´ØºÙŠÙ„ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
function fetchDishes(category) {
    db.collection("dishes").where("category", "==", category).onSnapshot(snap => {
        const grid = document.getElementById('grid');
        grid.innerHTML = "";
        snap.forEach(doc => {
            const data = doc.data();
            const card = document.createElement('div');
            card.className = 'card';
            card.innerHTML = `
                <img src="${data.img || ''}">
                <div class="card-content">
                    <h4>${data.name}</h4>
                    <p class="card-price">${data.price} Ø¯Ø¬</p>
                </div>`;
            card.onclick = () => openModal(data);
            grid.appendChild(card);
        });
    });
}

function openModal(item) {
    currentItem = item;
    document.getElementById('dishName').innerText = item.name;
    document.getElementById('dishPrice').innerText = item.price + " Ø¯Ø¬";
    document.getElementById('dishIng').innerText = item.ingredients || "Ø·Ø¨ÙŠØ¹ÙŠ";
    document.getElementById('dishBen').innerText = item.benefits || "ØµØ­ÙŠ";
    document.getElementById('dishImage').src = item.img;
    
    // ØªØµÙÙŠØ± Ø§Ù„ÙÙŠØ¯ÙŠÙˆ
    const video = document.getElementById('dishVideo');
    const vOverlay = document.getElementById('videoOverlay');
    video.style.display = 'none';
    document.getElementById('dishImage').style.display = 'block';
    document.getElementById('stopVideoBtn').style.display = 'none';

    if(item.video && item.video !== "") {
        video.src = item.video;
        video.load();
        vOverlay.style.display = 'flex';
    } else {
        vOverlay.style.display = 'none';
    }

    const isInCart = cart.some(i => i.name === item.name);
    document.getElementById('addBtnText').innerText = isInCart ? "Ø­Ø°Ù Ù…Ù† Ø§Ù„Ø³Ù„Ø©" : "Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø·Ù„Ø¨";
    
    document.getElementById('dishOverlay').classList.add('show');
}

// Ø¯Ø§Ù„Ø© ØªØ´ØºÙŠÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø§Ù„Ù…ØµØ­Ø­Ø©
function toggleVideo() {
    const video = document.getElementById('dishVideo');
    const img = document.getElementById('dishImage');
    const vOverlay = document.getElementById('videoOverlay');
    const stopBtn = document.getElementById('stopVideoBtn');

    img.style.display = 'none';
    vOverlay.style.display = 'none';
    video.style.display = 'block';
    stopBtn.style.display = 'flex';
    
    video.play().catch(error => {
        console.log("Autoplay blocked or error:", error);
    });
}

function stopVideo(e) {
    if(e) e.stopPropagation();
    const video = document.getElementById('dishVideo');
    const img = document.getElementById('dishImage');
    const vOverlay = document.getElementById('videoOverlay');
    const stopBtn = document.getElementById('stopVideoBtn');

    video.pause();
    video.style.display = 'none';
    img.style.display = 'block';
    vOverlay.style.display = 'flex';
    stopBtn.style.display = 'none';
}

function handleCartAction() {
    const idx = cart.findIndex(i => i.name === currentItem.name);
    if(idx > -1) cart.splice(idx, 1);
    else cart.push(currentItem);
    
    updateUI();
    closeModal('dishOverlay');
}

function updateUI() {
    document.getElementById('cartCount').innerText = cart.length;
    const total = cart.reduce((sum, i) => sum + parseInt(i.price), 0);
    document.getElementById('floatTotal').innerText = total + " Ø¯Ø¬";
}

function openCartConfirmation() {
    if(cart.length === 0) return alert("Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©!");
    const list = document.getElementById('cartItemsList');
    list.innerHTML = "";
    let total = 0;
    cart.forEach((item, index) => {
        total += parseInt(item.price);
        list.innerHTML += `
            <div style="display:flex; justify-content:space-between; padding:10px; background:#f9f9f9; border-radius:10px; margin-bottom:8px;">
                <span>${item.name}</span>
                <strong>${item.price} Ø¯Ø¬</strong>
            </div>`;
    });
    document.getElementById('finalTotal').innerText = total + " Ø¯Ø¬";
    document.getElementById('cartOverlay').classList.add('show');
}

function sendOrderToKitchen() {
    const btn = document.getElementById('sendBtn');
    btn.disabled = true;
    
    const orderData = {
        items: cart,
        table: 2,
        status: "Ø¬Ø¯ÙŠØ¯",
        time: firebase.firestore.FieldValue.serverTimestamp()
    };

    db.collection("menu").add(orderData).then(() => {
        alert("ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ù„Ù„Ù…Ø·Ø¨Ø®! (Ø·Ø§ÙˆÙ„Ø© 2)");
        cart = [];
        updateUI();
        closeModal('cartOverlay');
        btn.disabled = false;
    });
}

function closeModal(id) {
    document.getElementById(id).classList.remove('show');
    if(id === 'dishOverlay') stopVideo();
}

function changeCat(cat, el) {
    document.querySelectorAll('.cat-item').forEach(i => i.classList.remove('active'));
    el.classList.add('active');
    fetchDishes(cat);
}

window.onload = () => fetchDishes('Ø·Ø¹Ø§Ù…');
</script>
</body>
</html>
