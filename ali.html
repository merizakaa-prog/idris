<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø°ÙƒÙŠØ©</title>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    
    <style>
        :root { --main: #8b0000; --secondary: #2ecc71; }
        body { font-family: 'Tahoma', sans-serif; background: #f4f4f4; padding: 20px; direction: rtl; }
        .admin-container { max-width: 600px; margin: auto; background: #fff; padding: 25px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        h2 { text-align: center; color: var(--main); }
        label { display: block; margin-top: 15px; font-weight: bold; font-size: 14px; }
        input, select, textarea { width: 100%; padding: 12px; margin-top: 5px; border: 1px solid #ddd; border-radius: 10px; box-sizing: border-box; }
        .btn-add { width: 100%; padding: 15px; border: none; border-radius: 10px; font-weight: bold; cursor: pointer; transition: 0.3s; background: var(--secondary); color: white; margin-top: 20px; }
        #status { text-align: center; margin-top: 15px; font-weight: bold; line-height: 1.6; }
        .file-info { font-size: 11px; color: #d35400; margin-top: 5px; }
    </style>
</head>
<body>

<div class="admin-container">
    <h2>â• Ø¥Ø¶Ø§ÙØ© Ø·Ø¨Ù‚ Ø¬Ø¯ÙŠØ¯</h2>
    
    <label>Ø§Ù„Ù‚Ø³Ù… (Category):</label>
    <select id="itemCategory">
        <option value="Ø·Ø¹Ø§Ù…">Ø·Ø¹Ø§Ù… ğŸ½ï¸</option>
        <option value="Ù…Ø´Ø±ÙˆØ¨Ø§Øª">Ù…Ø´Ø±ÙˆØ¨Ø§Øª ğŸ¥¤</option>
        <option value="ØªØ­Ù„ÙŠØ©">ØªØ­Ù„ÙŠØ© ğŸ°</option>
        <option value="Ù‚Ø§Ø·Ùˆ">Ù‚Ø§Ø·Ùˆ ğŸª</option>
    </select>

    <label>Ø§Ø³Ù… Ø§Ù„Ø·Ø¨Ù‚:</label>
    <input type="text" id="itemName" placeholder="Ù…Ø«Ù„Ø§Ù‹: Ø¨ÙŠØªØ²Ø§ Ù…Ø§Ø±ØºØ±ÙŠØªØ§">

    <label>Ø§Ù„Ø³Ø¹Ø± (Ø¯Ø¬):</label>
    <input type="number" id="itemPrice" placeholder="Ù…Ø«Ù„Ø§Ù‹: 1200">

    <label>Ø§Ø®ØªÙŠØ§Ø± ØµÙˆØ±Ø© Ø§Ù„Ø·Ø¨Ù‚ ğŸ“·:</label>
    <input type="file" id="fileImg" accept="image/*">

    <label>Ø§Ø®ØªÙŠØ§Ø± ÙÙŠØ¯ÙŠÙˆ Ù‚ØµÙŠØ± ğŸ¥ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ):</label>
    <input type="file" id="fileVideo" accept="video/*">
    <div class="file-info">* ÙŠÙØ¶Ù„ Ø£Ù† ÙŠÙƒÙˆÙ† Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ù‚ØµÙŠØ± Ø¬Ø¯Ø§Ù‹ (Ø£Ù‚Ù„ Ù…Ù† 10 Ø«ÙˆØ§Ù†ÙŠ)</div>

    <label>Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª (Ø§ÙØµÙ„ Ø¨ÙŠÙ†Ù‡Ø§ Ø¨ÙØ§ØµÙ„Ø©):</label>
    <textarea id="itemIngredients" placeholder="Ø·Ù…Ø§Ø·Ù…, Ø¬Ø¨Ù†, Ø²ÙŠØªÙˆÙ†..."></textarea>

    <label>Ø§Ù„ÙÙˆØ§Ø¦Ø¯ (Ø§ÙØµÙ„ Ø¨ÙŠÙ†Ù‡Ø§ Ø¨ÙØ§ØµÙ„Ø©):</label>
    <textarea id="itemBenefits" placeholder="ØºÙ†ÙŠ Ø¨Ø§Ù„Ø¨Ø±ÙˆØªÙŠÙ†, Ø·Ø§Ù‚Ø© ÙÙˆØ±ÙŠØ©..."></textarea>

    <button class="btn-add" id="submitBtn" onclick="handleUpload()">Ø­ÙØ¸ ÙˆÙ†Ø´Ø± Ø§Ù„Ø·Ø¨Ù‚ Ø§Ù„Ø¢Ù† âœ…</button>

    <p id="status"></p>
</div>

<script>
// --- Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Firebase ---
const firebaseConfig = {
    apiKey: "YOUR_API_KEY",
    authDomain: "restaurant-e323a.firebaseapp.com",
    projectId: "restaurant-e323a",
    storageBucket: "restaurant-e323a.appspot.com",
    messagingSenderId: "309092455734",
    appId: "YOUR_APP_ID"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

// --- Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Cloudinary ---
const CLOUDINARY_URL = "https://api.cloudinary.com/v1_1/dzrrirfig/upload";
const CLOUDINARY_PRESET = "restaurant_preset";

async function uploadFile(file) {
    const formData = new FormData();
    formData.append("file", file);
    formData.append("upload_preset", CLOUDINARY_PRESET);
    
    const resp = await fetch(CLOUDINARY_URL, { method: "POST", body: formData });
    const data = await resp.json();
    return data.secure_url;
}

async function handleUpload() {
    const status = document.getElementById('status');
    const btn = document.getElementById('submitBtn');
    const imgFile = document.getElementById('fileImg').files[0];
    const videoFile = document.getElementById('fileVideo').files[0];
    
    const name = document.getElementById('itemName').value;
    const price = document.getElementById('itemPrice').value;

    if(!name || !price || !imgFile) {
        alert("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„Ø³Ø¹Ø± ÙˆØ§Ø®ØªÙŠØ§Ø± ØµÙˆØ±Ø©!");
        return;
    }

    btn.disabled = true;
    status.style.color = "orange";
    status.innerText = "â³ Ø¬Ø§Ø±ÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù…Ù„ÙØ§Øª... Ù‚Ø¯ ÙŠØ³ØªØºØ±Ù‚ Ø§Ù„Ø±ÙØ¹ Ø«ÙˆØ§Ù†Ù";

    try {
        // 1. Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø©
        const imgUrl = await uploadFile(imgFile);
        
        // 2. Ø±ÙØ¹ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ (Ø¥Ø°Ø§ ÙˆÙØ¬Ø¯)
        let videoUrl = "";
        if(videoFile) {
            status.innerText = "â³ Ø¬Ø§Ø±ÙŠ Ø±ÙØ¹ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø§Ù„Ø¢Ù†...";
            videoUrl = await uploadFile(videoFile);
        }

        // 3. Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Firestore
        const ingredients = document.getElementById('itemIngredients').value.split(',').map(s => s.trim());
        const benefits = document.getElementById('itemBenefits').value.split(',').map(s => s.trim());

        await db.collection("products").add({
            name: name,
            price: price,
            category: document.getElementById('itemCategory').value,
            img: imgUrl,
            video: videoUrl,
            ingredients: ingredients,
            benefits: benefits,
            createdAt: firebase.firestore.FieldValue.serverTimestamp()
        });

        status.style.color = "green";
        status.innerText = "âœ… ØªÙ… Ø¨Ù†Ø¬Ø§Ø­! Ø§Ù„Ø·Ø¨Ù‚ Ù…ØªØ§Ø­ Ø§Ù„Ø¢Ù† ÙÙŠ Ø§Ù„Ù…Ù†ÙŠÙˆ.";
        resetForm();

    } catch (err) {
        status.style.color = "red";
        status.innerText = "âŒ ÙØ´Ù„ Ø§Ù„Ø±ÙØ¹: " + err.message;
        console.error(err);
    } finally {
        btn.disabled = false;
    }
}

function resetForm() {
    document.querySelectorAll('input, textarea').forEach(el => el.value = "");
}
</script>

</body>
</html>
