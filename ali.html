<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… | Ø¥Ø¯Ø§Ø±Ø© Dishes</title>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    <style>
        :root { --main: #8b0000; --green: #2ecc71; --blue: #3498db; }
        body { font-family: 'Tahoma', sans-serif; background: #f4f4f4; padding: 20px; direction: rtl; }
        .admin-container { max-width: 600px; margin: auto; background: #fff; padding: 25px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); margin-bottom: 30px; }
        h2 { text-align: center; color: var(--main); }
        label { display: block; margin-top: 15px; font-weight: bold; font-size: 14px; }
        input, select, textarea { width: 100%; padding: 12px; margin-top: 5px; border: 1px solid #ddd; border-radius: 10px; box-sizing: border-box; }
        .btn-main { width: 100%; padding: 15px; border: none; border-radius: 10px; font-weight: bold; cursor: pointer; background: var(--green); color: white; margin-top: 20px; font-size: 16px; }
        .btn-cancel { background: #666; display: none; margin-top: 10px; color: white; }
        
        .items-list { max-width: 600px; margin: auto; background: #fff; padding: 20px; border-radius: 20px; box-shadow: 0 5px 15px rgba(0,0,0,0.05); }
        .item-row { display: flex; align-items: center; justify-content: space-between; padding: 10px; border-bottom: 1px solid #eee; gap: 10px; }
        .item-row img { width: 50px; height: 50px; border-radius: 8px; object-fit: cover; }
        .actions button { padding: 5px 10px; border: none; border-radius: 5px; cursor: pointer; font-size: 12px; color: white; margin-left: 5px; }
        .btn-edit { background: var(--blue); }
        .btn-del { background: var(--main); }
        #status { text-align: center; margin-top: 15px; font-weight: bold; color: var(--main); }
        .video-preview { font-size: 12px; color: var(--blue); margin-top: 5px; display: none; }
    </style>
</head>
<body>

<div class="admin-container">
    <h2 id="formTitle">â• Ø¥Ø¶Ø§ÙØ© Ø·Ø¨Ù‚ Ø¬Ø¯ÙŠØ¯ Ø¥Ù„Ù‰ Dishes</h2>
    
    <input type="hidden" id="editId">
    
    <label>Ø§Ù„Ù‚Ø³Ù…:</label>
    <select id="itemCategory">
        <option value="Ø·Ø¹Ø§Ù…">Ø·Ø¹Ø§Ù… ğŸ½ï¸</option>
        <option value="Ù…Ø´Ø±ÙˆØ¨Ø§Øª">Ù…Ø´Ø±ÙˆØ¨Ø§Øª ğŸ¥¤</option>
        <option value="ØªØ­Ù„ÙŠØ©">ØªØ­Ù„ÙŠØ© ğŸ°</option>
        <option value="Ù‚Ø§Ø·Ùˆ">Ù‚Ø§Ø·Ùˆ ğŸª</option>
    </select>

    <label>Ø§Ø³Ù… Ø§Ù„Ø·Ø¨Ù‚:</label>
    <input type="text" id="itemName" placeholder="Ø§Ø³Ù… Ø§Ù„Ø·Ø¨Ù‚">
    
    <label>Ø§Ù„Ø³Ø¹Ø± (Ø¯Ø¬):</label>
    <input type="number" id="itemPrice" placeholder="Ø§Ù„Ø³Ø¹Ø±">
    
    <label>ØµÙˆØ±Ø© Ø§Ù„Ø·Ø¨Ù‚ (Ø§Ø®ØªØ± Ù…Ù„ÙØ§Ù‹ Ø¬Ø¯ÙŠØ¯Ø§Ù‹ Ù„Ù„ØªØºÙŠÙŠØ±):</label>
    <input type="file" id="fileImg" accept="image/*">

    <label>ÙÙŠØ¯ÙŠÙˆ Ø§Ù„Ø·Ø¨Ù‚ (Ø§Ø®ØªØ± Ù…Ù„ÙØ§Ù‹ Ø¬Ø¯ÙŠØ¯Ø§Ù‹ Ù„Ù„ØªØºÙŠÙŠØ±):</label>
    <input type="file" id="fileVideo" accept="video/*">
    <div id="videoPresent" class="video-preview">âœ… ÙŠÙˆØ¬Ø¯ ÙÙŠØ¯ÙŠÙˆ Ù…Ø³Ø¬Ù„ Ù„Ù‡Ø°Ø§ Ø§Ù„Ø·Ø¨Ù‚</div>

    <label>Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª (ÙØ§ØµÙ„Ø© Ø¨ÙŠÙ† ÙƒÙ„ Ù…ÙƒÙˆÙ†):</label>
    <textarea id="itemIngredients" placeholder="Ù…ÙƒÙˆÙ† 1, Ù…ÙƒÙˆÙ† 2..."></textarea>
    
    <label>Ø§Ù„ÙÙˆØ§Ø¦Ø¯ (ÙØ§ØµÙ„Ø© Ø¨ÙŠÙ† ÙƒÙ„ ÙØ§Ø¦Ø¯Ø©):</label>
    <textarea id="itemBenefits" placeholder="ÙØ§Ø¦Ø¯Ø© 1, ÙØ§Ø¦Ø¯Ø© 2..."></textarea>

    <button id="submitBtn" class="btn-main" onclick="handleUpload()">Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª âœ…</button>
    <button id="cancelBtn" class="btn-main btn-cancel" onclick="resetForm()">Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ âœ–</button>
    <p id="status"></p>
</div>

<div class="items-list">
    <h3>ğŸ“‚ Ø§Ù„Ø£Ø·Ø¨Ø§Ù‚ ÙÙŠ Ù…Ø¬Ù…ÙˆØ¹Ø© Dishes:</h3>
    <div id="itemsContainer">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
</div>

<script>
// Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Firebase
const firebaseConfig = {
    apiKey: "YOUR_API_KEY",
    authDomain: "restaurant-e323a.firebaseapp.com",
    projectId: "restaurant-e323a",
    storageBucket: "restaurant-e323a.appspot.com",
    messagingSenderId: "309092455734",
    appId: "YOUR_APP_ID"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

const CLOUD_NAME = "dzrrirfig";
const PRESET = "restaurant_preset";

async function uploadToCloudinary(file) {
    const formData = new FormData();
    formData.append("file", file);
    formData.append("upload_preset", PRESET);
    const response = await fetch(`https://api.cloudinary.com/v1_1/${CLOUD_NAME}/auto/upload`, { method: "POST", body: formData });
    const data = await response.json();
    return data.secure_url;
}

// Ø¯Ø§Ù„Ø© Ø§Ù„Ø­ÙØ¸ (Ø¥Ø¶Ø§ÙØ© Ø£Ùˆ ØªØ¹Ø¯ÙŠÙ„)
async function handleUpload() {
    const editId = document.getElementById('editId').value;
    const name = document.getElementById('itemName').value;
    const price = document.getElementById('itemPrice').value;
    const imgFile = document.getElementById('fileImg').files[0];
    const videoFile = document.getElementById('fileVideo').files[0];
    const status = document.getElementById('status');
    const btn = document.getElementById('submitBtn');

    if (!name || !price) { alert("ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„Ø³Ø¹Ø±!"); return; }

    btn.disabled = true;
    status.innerText = "â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø±ÙØ¹ ÙˆØ§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©...";
    
    try {
        let updateData = {
            name: name,
            price: price,
            category: document.getElementById('itemCategory').value,
            ingredients: document.getElementById('itemIngredients').value.split(',').map(s => s.trim()).filter(s => s !== ""),
            benefits: document.getElementById('itemBenefits').value.split(',').map(s => s.trim()).filter(s => s !== ""),
            updatedAt: firebase.firestore.FieldValue.serverTimestamp()
        };

        if (imgFile) updateData.img = await uploadToCloudinary(imgFile);
        if (videoFile) updateData.video = await uploadToCloudinary(videoFile);

        if (editId) {
            await db.collection("dishes").doc(editId).update(updateData);
            status.innerText = "âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø·Ø¨Ù‚ Ø¨Ù†Ø¬Ø§Ø­!";
        } else {
            updateData.createdAt = firebase.firestore.FieldValue.serverTimestamp();
            await db.collection("dishes").add(updateData);
            status.innerText = "âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø·Ø¨Ù‚ Ø§Ù„Ø¬Ø¯ÙŠØ¯!";
        }
        setTimeout(resetForm, 2000);
    } catch (e) {
        status.innerText = "âŒ Ø®Ø·Ø£: " + e.message;
    } finally {
        btn.disabled = false;
    }
}

function loadItems() {
    db.collection("dishes").orderBy("createdAt", "desc").onSnapshot(snap => {
        const container = document.getElementById('itemsContainer');
        container.innerHTML = "";
        snap.forEach(doc => {
            const item = doc.data();
            container.innerHTML += `
                <div class="item-row">
                    <img src="${item.img || ''}">
                    <div style="flex-grow:1; margin-right:10px;">
                        <b>${item.name}</b>
                        <div style="font-size:12px; color:#777;">${item.price} Ø¯Ø¬</div>
                    </div>
                    <div class="actions">
                        <button class="btn-edit" onclick='startEdit("${doc.id}", ${JSON.stringify(item)})'>ØªØ¹Ø¯ÙŠÙ„</button>
                        <button class="btn-del" onclick='deleteItem("${doc.id}")'>Ø­Ø°Ù</button>
                    </div>
                </div>`;
        });
    });
}

// Ø¯Ø§Ù„Ø© Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…ØµØ­Ø­Ø© - Ø¥Ø¸Ù‡Ø§Ø± Ø­Ø§Ù„Ø© Ø§Ù„ÙÙŠØ¯ÙŠÙˆ
function startEdit(id, data) {
    document.getElementById('editId').value = id;
    document.getElementById('itemName').value = data.name;
    document.getElementById('itemPrice').value = data.price;
    document.getElementById('itemCategory').value = data.category;
    document.getElementById('itemIngredients').value = data.ingredients ? data.ingredients.join(', ') : "";
    document.getElementById('itemBenefits').value = data.benefits ? data.benefits.join(', ') : "";
    
    // Ø¥Ø¸Ù‡Ø§Ø± ØªÙ†Ø¨ÙŠÙ‡ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø·Ø¨Ù‚ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ ÙÙŠØ¯ÙŠÙˆ Ø£ØµÙ„Ø§Ù‹
    const videoNote = document.getElementById('videoPresent');
    if (data.video) {
        videoNote.style.display = "block";
        videoNote.innerHTML = `âœ… ÙŠÙˆØ¬Ø¯ ÙÙŠØ¯ÙŠÙˆ Ø­Ø§Ù„ÙŠ (<a href="${data.video}" target="_blank">Ø¹Ø±Ø¶</a>)`;
    } else {
        videoNote.style.display = "none";
    }

    document.getElementById('formTitle').innerText = "ğŸ“ ØªØ¹Ø¯ÙŠÙ„ Ø·Ø¨Ù‚ ÙÙŠ Dishes";
    document.getElementById('submitBtn').innerText = "ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª âœ…";
    document.getElementById('cancelBtn').style.display = "block";
    window.scrollTo({ top: 0, behavior: 'smooth' });
}

function resetForm() {
    document.getElementById('editId').value = "";
    document.querySelectorAll('input, textarea').forEach(i => i.value = "");
    document.getElementById('videoPresent').style.display = "none";
    document.getElementById('formTitle').innerText = "â• Ø¥Ø¶Ø§ÙØ© Ø·Ø¨Ù‚ Ø¬Ø¯ÙŠØ¯ Ø¥Ù„Ù‰ Dishes";
    document.getElementById('submitBtn').innerText = "Ø­ÙØ¸ ÙˆÙ†Ø´Ø± Ø§Ù„Ø·Ø¨Ù‚ âœ…";
    document.getElementById('cancelBtn').style.display = "none";
    document.getElementById('status').innerText = "";
}

async function deleteItem(id) {
    if (confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø·Ø¨Ù‚ Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ØŸ")) {
        await db.collection("dishes").doc(id).delete();
    }
}

loadItems();
</script>
</body>
</html>
