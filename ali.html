<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… | dishes</title>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    <style>
        :root { --main: #8b0000; --green: #2ecc71; }
        body { font-family: 'Tahoma', sans-serif; background: #f4f4f4; padding: 20px; direction: rtl; }
        .admin-container { max-width: 600px; margin: auto; background: #fff; padding: 25px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        input, select, textarea { width: 100%; padding: 12px; margin-top: 8px; border: 1px solid #ddd; border-radius: 10px; box-sizing: border-box; }
        .btn-main { width: 100%; padding: 15px; border: none; border-radius: 10px; background: var(--green); color: white; cursor: pointer; font-weight: bold; margin-top: 20px; }
        .item-row { display: flex; align-items: center; justify-content: space-between; padding: 10px; border-bottom: 1px solid #eee; background: white; margin-top: 10px; border-radius: 10px; }
        .item-row img { width: 50px; height: 50px; border-radius: 8px; object-fit: cover; }
    </style>
</head>
<body>

<div class="admin-container">
    <h2 id="formTitle">â• Ø¥Ø¶Ø§ÙØ© Ø·Ø¨Ù‚ Ø¥Ù„Ù‰ dishes</h2>
    <input type="hidden" id="editId">
    
    <select id="itemCategory">
        <option value="Ø·Ø¹Ø§Ù…">Ø·Ø¹Ø§Ù…</option>
        <option value="Ù…Ø´Ø±ÙˆØ¨Ø§Øª">Ù…Ø´Ø±ÙˆØ¨Ø§Øª</option>
        <option value="ØªØ­Ù„ÙŠØ©">ØªØ­Ù„ÙŠØ©</option>
        <option value="Ù‚Ø§Ø·Ùˆ">Ù‚Ø§Ø·Ùˆ</option>
    </select>

    <input type="text" id="itemName" placeholder="Ø§Ø³Ù… Ø§Ù„Ø·Ø¨Ù‚">
    <input type="number" id="itemPrice" placeholder="Ø§Ù„Ø³Ø¹Ø±">
    <input type="file" id="fileImg" accept="image/*">
    <textarea id="itemIngredients" placeholder="Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª (Ø§ÙØµÙ„ Ø¨ÙŠÙ†Ù‡Ø§ Ø¨ÙØ§ØµÙ„Ø© ,)"></textarea>
    <textarea id="itemBenefits" placeholder="Ø§Ù„ÙÙˆØ§Ø¦Ø¯ (Ø§ÙØµÙ„ Ø¨ÙŠÙ†Ù‡Ø§ Ø¨ÙØ§ØµÙ„Ø© ,)"></textarea>

    <button id="submitBtn" class="btn-main" onclick="handleUpload()">Ø­ÙØ¸ Ø§Ù„Ø·Ø¨Ù‚ âœ…</button>
    <p id="status" style="text-align:center;"></p>
</div>

<div id="itemsContainer" style="max-width:600px; margin:20px auto;"></div>

<script>
const firebaseConfig = {
    apiKey: "YOUR_API_KEY",
    authDomain: "restaurant-e323a.firebaseapp.com",
    projectId: "restaurant-e323a",
    storageBucket: "restaurant-e323a.appspot.com",
    messagingSenderId: "309092455734",
    appId: "YOUR_APP_ID"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

// Cloudinary Config
const CLOUD_NAME = "dzrrirfig";
const PRESET = "restaurant_preset";

async function uploadToCloudinary(file) {
    const formData = new FormData();
    formData.append("file", file);
    formData.append("upload_preset", PRESET);
    const res = await fetch(`https://api.cloudinary.com/v1_1/${CLOUD_NAME}/auto/upload`, { method: "POST", body: formData });
    const data = await res.json();
    return data.secure_url;
}

async function handleUpload() {
    const editId = document.getElementById('editId').value;
    const status = document.getElementById('status');
    status.innerText = "â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¹Ù…Ù„...";
    
    try {
        const ingredientsArr = document.getElementById('itemIngredients').value.split(',').map(s => s.trim()).filter(s => s !== "");
        const benefitsArr = document.getElementById('itemBenefits').value.split(',').map(s => s.trim()).filter(s => s !== "");

        let updateData = {
            name: document.getElementById('itemName').value,
            price: document.getElementById('itemPrice').value,
            category: document.getElementById('itemCategory').value,
            ingredients: ingredientsArr,
            benefits: benefitsArr,
            updatedAt: firebase.firestore.FieldValue.serverTimestamp()
        };

        const imgFile = document.getElementById('fileImg').files[0];
        if (imgFile) updateData.img = await uploadToCloudinary(imgFile);

        if (editId) {
            await db.collection("dishes").doc(editId).update(updateData);
        } else {
            updateData.createdAt = firebase.firestore.FieldValue.serverTimestamp();
            await db.collection("dishes").add(updateData);
        }
        status.innerText = "âœ… Ù†Ø¬Ø­Øª Ø§Ù„Ø¹Ù…Ù„ÙŠØ©!";
        location.reload();
    } catch (e) { status.innerText = "âŒ Ø®Ø·Ø£: " + e.message; }
}

function loadItems() {
    db.collection("dishes").orderBy("createdAt", "desc").onSnapshot(snap => {
        const container = document.getElementById('itemsContainer');
        container.innerHTML = "<h3>Ø§Ù„Ø£Ø·Ø¨Ø§Ù‚ ÙÙŠ dishes:</h3>";
        snap.forEach(doc => {
            const item = doc.data();
            container.innerHTML += `
                <div class="item-row">
                    <img src="${item.img || ''}">
                    <div><b>${item.name}</b></div>
                    <button onclick='startEdit("${doc.id}", ${JSON.stringify(item)})'>ØªØ¹Ø¯ÙŠÙ„</button>
                </div>`;
        });
    });
}
function startEdit(id, data) {
    document.getElementById('editId').value = id;
    document.getElementById('itemName').value = data.name;
    document.getElementById('itemPrice').value = data.price;
    document.getElementById('itemIngredients').value = data.ingredients.join(',');
    document.getElementById('itemBenefits').value = data.benefits.join(',');
    document.getElementById('formTitle').innerText = "ğŸ“ ØªØ¹Ø¯ÙŠÙ„ ÙÙŠ dishes";
}
loadItems();
</script>
</body>
</html>
