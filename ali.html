<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… | Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù†ÙŠÙˆ</title>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    <style>
        :root { --main: #8b0000; --green: #2ecc71; --blue: #3498db; }
        body { font-family: 'Tahoma', sans-serif; background: #f4f4f4; padding: 20px; direction: rtl; }
        .admin-container { max-width: 600px; margin: auto; background: #fff; padding: 25px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); margin-bottom: 30px; }
        h2 { text-align: center; color: var(--main); }
        label { display: block; margin-top: 15px; font-weight: bold; font-size: 14px; }
        input, select, textarea { width: 100%; padding: 12px; margin-top: 5px; border: 1px solid #ddd; border-radius: 10px; box-sizing: border-box; }
        .btn-main { width: 100%; padding: 15px; border: none; border-radius: 10px; font-weight: bold; cursor: pointer; background: var(--green); color: white; margin-top: 20px; font-size: 16px; }
        .btn-cancel { background: #666; display: none; margin-top: 10px; }
        
        /* ØªÙ†Ø³ÙŠÙ‚ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª */
        .items-list { max-width: 600px; margin: auto; background: #fff; padding: 20px; border-radius: 20px; box-shadow: 0 5px 15px rgba(0,0,0,0.05); }
        .item-row { display: flex; align-items: center; justify-content: space-between; padding: 10px; border-bottom: 1px solid #eee; gap: 10px; }
        .item-row img { width: 50px; height: 50px; border-radius: 8px; object-fit: cover; }
        .item-info { flex-grow: 1; }
        .item-info b { display: block; font-size: 14px; }
        .item-info span { font-size: 12px; color: #777; }
        .actions button { padding: 5px 10px; border: none; border-radius: 5px; cursor: pointer; font-size: 12px; color: white; }
        .btn-edit { background: var(--blue); }
        .btn-del { background: var(--main); }
        #status { text-align: center; margin-top: 15px; font-weight: bold; }
    </style>
</head>
<body>

<div class="admin-container">
    <h2 id="formTitle">â• Ø¥Ø¶Ø§ÙØ© Ø·Ø¨Ù‚ Ø¬Ø¯ÙŠØ¯</h2>
    
    <input type="hidden" id="editId"> <label>Ø§Ù„Ù‚Ø³Ù…:</label>
    <select id="itemCategory">
        <option value="Ø·Ø¹Ø§Ù…">Ø·Ø¹Ø§Ù… ğŸ½ï¸</option>
        <option value="Ù…Ø´Ø±ÙˆØ¨Ø§Øª">Ù…Ø´Ø±ÙˆØ¨Ø§Øª ğŸ¥¤</option>
        <option value="ØªØ­Ù„ÙŠØ©">ØªØ­Ù„ÙŠØ© ğŸ°</option>
        <option value="Ù‚Ø§Ø·Ùˆ">Ù‚Ø§Ø·Ùˆ ğŸª</option>
    </select>

    <input type="text" id="itemName" placeholder="Ø§Ø³Ù… Ø§Ù„Ø·Ø¨Ù‚">
    <input type="number" id="itemPrice" placeholder="Ø§Ù„Ø³Ø¹Ø± (Ø¯Ø¬)">
    
    <label>ØµÙˆØ±Ø© Ø§Ù„Ø·Ø¨Ù‚ (Ø§ØªØ±ÙƒÙ‡Ø§ ÙØ§Ø±ØºØ© Ø¹Ù†Ø¯ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø¥Ø°Ø§ Ù„Ù… ØªØ±Ø¯ ØªØºÙŠÙŠØ±Ù‡Ø§):</label>
    <input type="file" id="fileImg" accept="image/*">

    <label>ÙÙŠØ¯ÙŠÙˆ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ):</label>
    <input type="file" id="fileVideo" accept="video/*">

    <textarea id="itemIngredients" placeholder="Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª (ÙØ§ØµÙ„Ø© Ø¨ÙŠÙ† ÙƒÙ„ Ù…ÙƒÙˆÙ†)"></textarea>
    <textarea id="itemBenefits" placeholder="Ø§Ù„ÙÙˆØ§Ø¦Ø¯ (ÙØ§ØµÙ„Ø© Ø¨ÙŠÙ† ÙƒÙ„ ÙØ§Ø¦Ø¯Ø©)"></textarea>

    <button id="submitBtn" class="btn-main" onclick="handleUpload()">Ø­ÙØ¸ ÙˆÙ†Ø´Ø± Ø§Ù„Ø·Ø¨Ù‚ âœ…</button>
    <button id="cancelBtn" class="btn-main btn-cancel" onclick="resetForm()">Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ âœ–</button>
    <p id="status"></p>
</div>

<div class="items-list">
    <h3>ğŸ“‚ Ø§Ù„Ø£Ø·Ø¨Ø§Ù‚ Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø© Ø­Ø§Ù„ÙŠØ§Ù‹:</h3>
    <div id="itemsContainer">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©...</div>
</div>

<script>
const firebaseConfig = {
    apiKey: "YOUR_API_KEY",
    authDomain: "restaurant-e323a.firebaseapp.com",
    projectId: "restaurant-e323a",
    storageBucket: "restaurant-e323a.appspot.com",
    messagingSenderId: "309092455734",
    appId: "YOUR_APP_ID"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

const CLOUD_NAME = "dzrrirfig";
const PRESET = "restaurant_preset";

// --- ÙˆØ¸ÙŠÙØ© Ø§Ù„Ø±ÙØ¹ Ù„Ù€ Cloudinary ---
async function uploadToCloudinary(file) {
    const formData = new FormData();
    formData.append("file", file);
    formData.append("upload_preset", PRESET);
    const response = await fetch(`https://api.cloudinary.com/v1_1/${CLOUD_NAME}/auto/upload`, { method: "POST", body: formData });
    const data = await response.json();
    return data.secure_url;
}

// --- ÙˆØ¸ÙŠÙØ© Ø§Ù„Ø­ÙØ¸ (Ø¥Ø¶Ø§ÙØ© Ø£Ùˆ ØªØ¹Ø¯ÙŠÙ„) ---
async function handleUpload() {
    const editId = document.getElementById('editId').value;
    const name = document.getElementById('itemName').value;
    const price = document.getElementById('itemPrice').value;
    const imgFile = document.getElementById('fileImg').files[0];
    const videoFile = document.getElementById('fileVideo').files[0];
    const status = document.getElementById('status');
    const btn = document.getElementById('submitBtn');

    if (!name || (!editId && !imgFile)) {
        alert("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©!"); return;
    }

    btn.disabled = true;
    status.innerText = "â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©...";
    
    try {
        let updateData = {
            name: name,
            price: price,
            category: document.getElementById('itemCategory').value,
            ingredients: document.getElementById('itemIngredients').value.split(',').map(s => s.trim()),
            benefits: document.getElementById('itemBenefits').value.split(',').map(s => s.trim()),
            updatedAt: firebase.firestore.FieldValue.serverTimestamp()
        };

        // Ø±ÙØ¹ Ù…Ù„ÙØ§Øª Ø¬Ø¯ÙŠØ¯Ø© Ø¥Ø°Ø§ ÙˆØ¬Ø¯Øª
        if (imgFile) updateData.img = await uploadToCloudinary(imgFile);
        if (videoFile) updateData.video = await uploadToCloudinary(videoFile);

        if (editId) {
            // Ø¹Ù…Ù„ÙŠØ© ØªØ¹Ø¯ÙŠÙ„
            await db.collection("products").doc(editId).update(updateData);
            status.innerText = "âœ… ØªÙ… ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø·Ø¨Ù‚ Ø¨Ù†Ø¬Ø§Ø­!";
        } else {
            // Ø¹Ù…Ù„ÙŠØ© Ø¥Ø¶Ø§ÙØ© Ø¬Ø¯ÙŠØ¯Ø©
            updateData.createdAt = firebase.firestore.FieldValue.serverTimestamp();
            await db.collection("products").add(updateData);
            status.innerText = "âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø·Ø¨Ù‚ Ø¨Ù†Ø¬Ø§Ø­!";
        }
        resetForm();
    } catch (e) {
        status.innerText = "âŒ Ø®Ø·Ø£: " + e.message;
    } finally {
        btn.disabled = false;
    }
}

// --- Ø¬Ù„Ø¨ ÙˆØ¹Ø±Ø¶ Ø§Ù„Ø£Ø·Ø¨Ø§Ù‚ ---
function loadItems() {
    const container = document.getElementById('itemsContainer');
    db.collection("products").orderBy("createdAt", "desc").onSnapshot(snap => {
        container.innerHTML = "";
        snap.forEach(doc => {
            const item = doc.data();
            container.innerHTML += `
                <div class="item-row">
                    <img src="${item.img}">
                    <div class="item-info">
                        <b>${item.name}</b>
                        <span>${item.category} - ${item.price} Ø¯Ø¬</span>
                    </div>
                    <div class="actions">
                        <button class="btn-edit" onclick='startEdit("${doc.id}", ${JSON.stringify(item)})'>ØªØ¹Ø¯ÙŠÙ„</button>
                        <button class="btn-del" onclick='deleteItem("${doc.id}")'>Ø­Ø°Ù</button>
                    </div>
                </div>`;
        });
    });
}

// --- ØªÙØ¹ÙŠÙ„ ÙˆØ¶Ø¹ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ ---
function startEdit(id, data) {
    document.getElementById('editId').value = id;
    document.getElementById('itemName').value = data.name;
    document.getElementById('itemPrice').value = data.price;
    document.getElementById('itemCategory').value = data.category;
    document.getElementById('itemIngredients').value = data.ingredients.join(', ');
    document.getElementById('itemBenefits').value = data.benefits.join(', ');
    
    document.getElementById('formTitle').innerText = "ğŸ“ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø·Ø¨Ù‚";
    document.getElementById('submitBtn').innerText = "ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø·Ø¨Ù‚ âœ…";
    document.getElementById('cancelBtn').style.display = "block";
    window.scrollTo(0, 0);
}

// --- Ø­Ø°Ù Ø·Ø¨Ù‚ ---
async function deleteItem(id) {
    if (confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø·Ø¨Ù‚ØŸ")) {
        await db.collection("products").doc(id).delete();
    }
}

// --- Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ ---
function resetForm() {
    document.getElementById('editId').value = "";
    document.querySelectorAll('input, textarea').forEach(i => i.value = "");
    document.getElementById('formTitle').innerText = "â• Ø¥Ø¶Ø§ÙØ© Ø·Ø¨Ù‚ Ø¬Ø¯ÙŠØ¯";
    document.getElementById('submitBtn').innerText = "Ø­ÙØ¸ ÙˆÙ†Ø´Ø± Ø§Ù„Ø·Ø¨Ù‚ âœ…";
    document.getElementById('cancelBtn').style.display = "none";
}

loadItems(); // ØªØ´ØºÙŠÙ„ Ø§Ù„Ø¬Ù„Ø¨ Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„ØµÙØ­Ø©
</script>
</body>
</html>
