<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<script>
    // إعدادات قاعدة البيانات (Firebase)
    const firebaseConfig = {
        databaseURL: "https://menu-restaurant-default-rtdb.firebaseio.com/" 
    };
    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();

    const cloudName = "dzrrirfig"; 
    const uploadPreset = "my_restaurant_preset"; 

    async function addNewItem() {
        const name = document.getElementById('itemName').value;
        const price = document.getElementById('itemPrice').value;
        const fileInput = document.getElementById('imageInput');
        const status = document.getElementById('status');

        if (!name || !price || !fileInput.files[0]) {
            alert("الرجاء ملء جميع الخانات!"); return;
        }

        status.innerText = "⏳ جاري الرفع للسحابة...";
        
        const formData = new FormData();
        formData.append('file', fileInput.files[0]);
        formData.append('upload_preset', uploadPreset);

        try {
            const response = await fetch(`https://api.cloudinary.com/v1_1/${cloudName}/image/upload`, {
                method: 'POST', body: formData
            });
            const data = await response.json();

            if (data.secure_url) {
                // حفظ في Firebase بدلاً من LocalStorage لكي يراها الجميع
                const newItemRef = database.ref('menu').push();
                await newItemRef.set({
                    name: name,
                    price: price,
                    image: data.secure_url
                });

                status.innerText = "✅ تم النشر بنجاح للجميع!";
                document.getElementById('itemName').value = "";
                document.getElementById('itemPrice').value = "";
            }
        } catch (e) { status.innerText = "❌ خطأ في الاتصال"; }
    }
</script>
